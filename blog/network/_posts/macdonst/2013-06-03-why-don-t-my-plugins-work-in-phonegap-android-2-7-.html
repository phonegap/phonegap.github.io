--- 
date: 2013-06-03 00:16:00 Z
permalink: /admin/blog/2013-06-03-why-don-t-my-plugins-work-in-phonegap-android-2-7-
author: Simon MacDonald
link: http://simonmacdonald.blogspot.com/2013/06/why-dont-my-plugins-work-in-phonegap.html
type: post
status: publish
tags:
- PhoneGap Network
format: html
title: Why Don't My Plugins Work in PhoneGap Android 2.7?
external: true
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-cs_a2ro_P0Y/TkA8D-vPCVI/AAAAAAAABwE/gHJwh4m8Jkw/s1600/pg.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="200" src="http://1.bp.blogspot.com/-cs_a2ro_P0Y/TkA8D-vPCVI/AAAAAAAABwE/gHJwh4m8Jkw/s200/pg.png" width="159" /></a></div>Well it's pretty simple, the Plugin class which has been deprecated for awhile has been removed from the package and should be replaced with CordovaPlugin. <br /><br />I'm going to go through the steps needed to upgrade your old style plugins to the new style. For this example I'm going to use the <a href="https://github.com/phonegap/phonegap-plugins/tree/master/Android/Analytics/2.0">Google Analytics plugin</a>.<br /><br />The first thing you will notice in 2.7.0+ is that the GoogleAnalyticsTracker class now has 4 errors in Eclipse. To get rid of them you would change:<br /><br />        <br /><div class="p1"><b><span class="s1">import</span> <span class="s2">org.apache.cordova.api.Plugin</span>;</b></div><div class="p1"><br /></div><div class="p1">into:</div><div class="p1"><br /></div><div class="p1">       </div><div class="p1"><b><span class="s1">import</span> <span class="s2">org.apache.cordova.api.CordovaPlugin</span>;</b></div><div class="p1"><br /></div><div class="p1">and:</div><div class="p1"><br /></div><div class="p1">       </div><div class="p1"><b><span class="s1">public</span><span class="s2"> </span><span class="s1">class</span><span class="s2"> </span>GoogleAnalyticsTracker<span class="s2"> </span><span class="s1">extends</span><span class="s2"> </span>Plugin<span class="s2"> {</span></b></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">to:</span></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">       </span></div><div class="p1"><b><span class="s1">public</span><span class="s2"> </span><span class="s1">class</span><span class="s2"> </span>GoogleAnalyticsTracker<span class="s2"> </span><span class="s1">extends</span><span class="s2"> </span>CordovaPlugin<span class="s2"> {</span></b></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">and now you'll notice you only have one error left in&nbsp;the file and that has to do with the execute method. You'll need to change&nbsp;the method signature from:</span></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">       </span></div><div class="p1"><b><span class="s1">public</span><span class="s2"> </span>PluginResult<span class="s2"> </span><span class="s3">execute</span><span class="s4">(</span><span class="s5">String</span><span class="s4"> </span><span class="s6">action</span><span class="s4">, </span><span class="s5">JSONArray</span><span class="s4"> </span><span class="s6">data</span><span class="s4">, </span><span class="s5">String</span><span class="s4"> </span><span class="s6">callbackId</span><span class="s4">)</span><span class="s2"> {</span></b></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">to:</span></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">       </span></div><div class="p1"><b><span class="s1">public</span><span class="s2"> </span>boolean<span class="s2"> </span><span class="s3">execute</span><span class="s4">(</span><span class="s5">String</span><span class="s4"> </span><span class="s6">action</span><span class="s4">, </span><span class="s5">JSONArray</span><span class="s4"> </span><span class="s6">data</span><span class="s4">, </span><span class="s5">String</span><span class="s4"> </span><span class="s6">callbackId</span><span class="s4">)</span><span class="s2"> {</span></b></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">and we still have one error which is now the line in which we are returning the PluginResult. That's because the method now expect a boolean to be the return value. To fix this issue you would replace:</span></div><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">       </span></div><div class="p1"><b>return<span class="s1"> </span><span class="s2">result</span><span class="s1">;</span></b></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1">with:</span></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1">       </span></div><div class="p1"><b><span class="s2">callbackContext</span><span class="s1">.</span>sendPluginResult<span class="s1">(</span><span class="s3">result</span><span class="s1">);</span></b></div><div class="p2"><b>return<span class="s1"> </span>true<span class="s1">;</span></b></div><div class="p2"><span class="s1"><br /></span></div><div class="p2"><span class="s1">Finally our Java code is free of error messages. Whew, were done but what's with&nbsp;the change to the execute method? Well let's just say there have been improvements in the way the Plugins are handled internally. What you need to know is that when you want to send a result back to the JavaScript side you now have a choice of three methods:</span></div><div class="p2"><span class="s1"><br /></span></div><div class="p2"><span class="s1"><b>1) callbackContext.sendPluginResult(...)</b></span></div><div class="p2"><span class="s1"><br /></span></div><div class="p2"><span class="s1">Use this if you have constructed your own PluginResult and you want to send it to the JavaScript side.</span></div><div class="p2"><span class="s1"><br /></span></div><div class="p2"><span class="s1"><b>2) callbackContext.error(int | String | JSONObject)&nbsp;</b></span></div><div class="p2"><span class="s1"><br /></span></div><div class="p2"><span class="s1">Skip creating a PluginResult and just invoke&nbsp;the error callback on&nbsp;the JavaScript side sending back an int, a String or a JSONObject as&nbsp;the method payload.</span></div><div class="p2"><span class="s1"><br /></span></div><div class="p2"><b><span class="s1">3) callbackContext.success(empty |&nbsp;</span>int | String | JSONObject | JSONArray)</b></div><div class="p2"><br /></div><div class="p2">Again, just skip creating&nbsp;the PluginResult and invoke&nbsp;the success callback on&nbsp;the JavaScript side sending back an int, a String, JSONObject or JSONArray as&nbsp;the method payload. If you don't provide any payload the method on&nbsp;the JS side will be executed with no payload.</div><div class="p2"><br /></div><div class="p2">So that should get you unstuck if you have a Plugin that no longer works for you as of PhoneGap 2.7.0. You should also check out my posts on the <a href="http://simonmacdonald.blogspot.ca/2013/01/galleryplugin.html">GalleryPlugin</a> as shows how to write a Plugin using the new API for JS and Java.</div><br /><br /><br /><br /><br /><br /><br />
