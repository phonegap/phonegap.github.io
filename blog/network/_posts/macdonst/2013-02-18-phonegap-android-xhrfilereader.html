--- 
author: Simon MacDonald
external: true
status: publish
tags:
- PhoneGap Network
link: http://simonmacdonald.blogspot.com/2013/02/phonegap-android-xhrfilereader.html
format: html
date: 2013-02-18 15:00:00 Z
type: post
title: PhoneGap Android XhrFileReader
permalink: /admin/blog/2013-02-18-phonegap-android-xhrfilereader
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-cs_a2ro_P0Y/TkA8D-vPCVI/AAAAAAAABwE/gHJwh4m8Jkw/s1600/pg.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="200" src="http://1.bp.blogspot.com/-cs_a2ro_P0Y/TkA8D-vPCVI/AAAAAAAABwE/gHJwh4m8Jkw/s200/pg.png" width="159" /></a></div>The FileReader API works great as long as the file you want to read is on the device's file system. However if you want to read a file you've packed in the Android assets folder you would need to use XHR to read the file. I'm providing an interface that follows the same API as the regular FileReader. Of course the <a href="https://github.com/macdonst/XhrFileReader">XhrFileReader</a> is not limited to only reading files from the assets folder, it can also read files from the file system and over HTTP.<br /><br /><b>Adding the plugin to your project&nbsp;</b><br /><br />To install the plugin, move XhrFileReader.js to your project's www folder and include a reference to it in your html files.<br /><br /><b>Using the plugin&nbsp;</b><br /><br />To instantiate a new reader use the folling code:<br /><blockquote class="tr_bq">var reader = cordova.require("cordova/plugin/xhrfilereader");&nbsp;</blockquote>Setup your event handlers:<br /><blockquote class="tr_bq">// called once the reader begins<br />reader.onloadstart = function() {<br />&nbsp; &nbsp; console.log("load start");<br />};<br />// called when the file has been completely read<br />reader.onloadend = function(evt) {<br />&nbsp; &nbsp; console.log("File read");<br />&nbsp; &nbsp; console.log(evt.target.result);<br />};&nbsp;</blockquote>Unfortunately, you will only get an error on files read over HTTP. When you specify a file:// path the request status is always 0. There is no way to tell between a successful read or an error. So if you specify a file that does not exist like "file:///does.not.exist.txt" you will get an empty evt.target.result in your onloadend handler.<br /><blockquote class="tr_bq">// called if the reader encounters an error<br />reader.onerror = function(error) {<br />&nbsp; &nbsp; console.log("Error: " + error.code);<br />};&nbsp;</blockquote>Progress events are fired but are not very useful as they don't contain partial results.<br /><blockquote class="tr_bq">// called while the file is being read<br />reader.onprogress = function(evt) {<br />&nbsp; &nbsp; console.log("progress");<br />};&nbsp;</blockquote>Finally call your read method, for instance:<br /><blockquote class="tr_bq">reader.readAsText("http://www.google.com"); reader.readAsText("file:///android_asset/www/config.json"); reader.readAsText("file:///sdcard/error.log");</blockquote>and that's about it. Obviously, this plugin is most useful when you need to read a text file from the assets folder.<br />
