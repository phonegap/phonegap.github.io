--- 
title: Building a Native Context Menu for PhoneGap Android
permalink: /admin/blog/2012-11-12-building-a-native-context-menu-for-phonegap-android
format: html
link: http://simonmacdonald.blogspot.com/2012/11/building-native-context-menu-for.html
status: publish
tags:
- PhoneGap Network
type: post
external: true
date: 2012-11-12 15:00:00 Z
author: Simon MacDonald
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-cs_a2ro_P0Y/TkA8D-vPCVI/AAAAAAAABwE/gHJwh4m8Jkw/s1600/pg.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="200" src="http://1.bp.blogspot.com/-cs_a2ro_P0Y/TkA8D-vPCVI/AAAAAAAABwE/gHJwh4m8Jkw/s200/pg.png" width="159" /></a></div>So I know I&nbsp;promised&nbsp;that I'd write about a HTML only menu but I thought folks might be interested in native context menus as well. It's not much different than my last blog post on menu's so it should be easy to follow.<br /><br />So when I talk about a native context menu I mean the menu that clicks when you do a long press on an Android device. Again this is well covered on the <a href="https://developer.android.com/guide/topics/ui/menus.html#context-menu">Android Developer page</a>. Here is an example of an context menu from the Contacts app:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-RgfsP_ivt6A/UJ1m3ajk-nI/AAAAAAAACJ0/AiR6lIyBTVk/s1600/Screen+Shot+2012-11-09+at+3.25.33+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://1.bp.blogspot.com/-RgfsP_ivt6A/UJ1m3ajk-nI/AAAAAAAACJ0/AiR6lIyBTVk/s400/Screen+Shot+2012-11-09+at+3.25.33+PM.png" width="238" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div><br />The first step in creating the menu is to define it in XML. My&nbsp;recommendation is to create a menu folder under the res folder in your Android Eclipse project. Then you create a new File with an XML extension. For this post I'll call mine example.xml. When you're done your res folder should look something like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-He1RJMLzUTk/UJcq5LYftrI/AAAAAAAACIc/__XM5XWHKqE/s1600/Screen+Shot+2012-11-04+at+9.56.18+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="268" src="http://2.bp.blogspot.com/-He1RJMLzUTk/UJcq5LYftrI/AAAAAAAACIc/__XM5XWHKqE/s400/Screen+Shot+2012-11-04+at+9.56.18+PM.png" width="400" /></a></div><br />Don't worry about the red X's as we haven't edited the XML file yet so it is going to complain about a premature end of file. For a real good description of what goes into a menu XML file <a href="https://developer.android.com/guide/topics/ui/menus.html#xml">read this</a>. For our purposes I'm just going to give you&nbsp;the XML to paste into&nbsp;the file:<br /><br /><script src="https://gist.github.com/4015145.js?file=example.xml"></script> But when you view the file in Eclipse you'll still see errors:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-DuOzoQMCazg/UJcxcxhObJI/AAAAAAAACIs/F_kxPP-rlzM/s1600/Screen+Shot+2012-11-04+at+10.24.23+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-DuOzoQMCazg/UJcxcxhObJI/AAAAAAAACIs/F_kxPP-rlzM/s1600/Screen+Shot+2012-11-04+at+10.24.23+PM.png" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">and that is to be expected as we haven't added the two images to the drawables folder nor have we added our two new strings to strings.xml. To fix these issues first download these two images:</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-w_TyB5Dy9yg/UJc0xMpda7I/AAAAAAAACJE/_xwcVadUC4s/s1600/settings.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-w_TyB5Dy9yg/UJc0xMpda7I/AAAAAAAACJE/_xwcVadUC4s/s1600/settings.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-IBlUdVoXhsI/UJc0gaKQAOI/AAAAAAAACI8/KauiIyIMmgo/s1600/help.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-IBlUdVoXhsI/UJc0gaKQAOI/AAAAAAAACI8/KauiIyIMmgo/s1600/help.png" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">and copy them to your projects res/drawable-hdpi folder. When you want to put out a professional application you'll need to <a href="https://developer.android.com/guide/practices/ui_guidelines/icon_design_menu.html">provide icons of various sizes</a> but the above is enough for our needs.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">To fix the rest of the red X's you'll need to open&nbsp;the res/values/strings.xml and add two new Strings. The first should have the name "settings" and a value of "Settings. The second should have the name"help" and, predictably, the value of "Help". At this point all the red X's from example.xml and from the res folder&nbsp;hierarchy&nbsp;should have disappeared.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-HQTy-XxENdA/UJc4Lv2pQ_I/AAAAAAAACJU/nXlVb7MiRHo/s1600/Screen+Shot+2012-11-04+at+10.52.55+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-HQTy-XxENdA/UJc4Lv2pQ_I/AAAAAAAACJU/nXlVb7MiRHo/s1600/Screen+Shot+2012-11-04+at+10.52.55+PM.png" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">If they haven't, well then you've done something wrong and should probably go back over all&nbsp;the steps to make sure you haven't missed anything.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Okay, so now we've got all the resources in place. Let's go write some actual Java code. Don't worry much of it will be cut and paste. In Eclipse open up your main Java class, you know the one that extends DroidGap.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">First you'll need to register the context menu in the onCreate method. Basically, you'll need to add the call to registerForContextMenu to your onCreate method:</div><div class="separator" style="clear: both; text-align: left;"><br /></div><script src="https://gist.github.com/4048040.js?file=onCreate.java"></script> <br /><div class="separator" style="clear: both; text-align: left;">Secondly we'll need to tell your application what to do when it detects a long press. You'll need to paste the following code into you main Java class:</div><div class="separator" style="clear: both; text-align: left;"><br /></div><script src="https://gist.github.com/4048040.js?file=onCreateContextMenu.java"></script>You shouldn't need to change anything unless you've called your menu XML file something different than example.xml. If you have you'll need to change R.menu.example into R.menu.<file name="name"> where you replace <file name="name"> with the name of your file minus the .xml extension.</file></file><br /><br />The last bit of code you need to add is a method that will tell your&nbsp;application&nbsp;what to do when the individual menu items are clicked. Here's some example code:<br /><br /><script src="https://gist.github.com/4048040.js?file=onContextItemSelected.java"></script><br />When you click on the Setting button we'll use an Android intent to load the devices Settings panel. If you click on the Help button then we'll execute some JavaScript code. That's it!&nbsp;You don't need to add anything to your HTML/JS code to get a native Android context menu working with your PhoneGap application. Here is what it would look like:<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-7kEtDelNr-k/UJ1pNxfp1fI/AAAAAAAACJ8/rpWTVTR_7FI/s1600/Screen+Shot+2012-11-09+at+3.35.44+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://1.bp.blogspot.com/-7kEtDelNr-k/UJ1pNxfp1fI/AAAAAAAACJ8/rpWTVTR_7FI/s400/Screen+Shot+2012-11-09+at+3.35.44+PM.png" width="241" /></a></div><br /><br />Please note, I'm just providing a quick example and you are not limited to how you handle the menu button clicks in the least. You may want to handle it in Java and do something that you can't do in JavaScript or you may want to call a JavaScript function on your page to have your UI react in some interesting way.<br /><br />So, there you go. The process is nearly identical to <a href="http://simonmacdonald.blogspot.ca/2012/11/building-native-menu-with-phonegap.html">creating an options menu that I described in my previous post</a>. I&nbsp;promise&nbsp;that in my next post I'll show you how to handle everything in HTML and JavaScript!<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/72386855013225666-9168420487076575510?l=simonmacdonald.blogspot.com' alt='' /></div>
